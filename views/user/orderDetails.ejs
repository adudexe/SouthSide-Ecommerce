<%- include('../partials/user/header') %>
<html lang="en">
    
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
    

<body>
    <div class="container mt-5">
        <header class="text-center mb-4">
            <h1 class="text-success">Order Details</h1>
        </header>
        
        <main>
            <section class="card mb-4">
                <div class="card-header bg-success text-white">Order Summary</div>
                <div class="card-body">
                    <p><strong>Order ID:</strong> <%= Order[0]._id %></p>
                    <p><strong>Date:</strong> <%= (Order[0].createdOn).toLocaleDateString('en-US', {
                        month: 'long',  // Full month name (e.g., "March")
                        day: 'numeric', // Day of the month (e.g., "25")
                        year: 'numeric' // Full year (e.g., "2020")
                      }); %></p>
                    <% if (Order[0].status == "Pending") { %>
                        <p><strong>Status:</strong> <span class="badge bg-warning"><%= Order[0].status %></span></p>    
                    <% } else if(Order[0].status == "Success"){ %>
                        <p><strong>Status:</strong> <span class="badge bg-success"><%= Order[0].status %></span></p>    
                    <% } else if(Order[0].status == "Canceled"){ %>
                        <p><strong>Status:</strong> <span class="badge bg-danger"><%= Order[0].status %></span></p>    
                    <% } %>
                     
                </div>
            </section>
            
            <section class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">Shipping Information</div>
                        <div class="card-body">
                            <p><strong>Name:</strong> <%= (Order[0].addres).name %></p>
                            <p><strong>Address:</strong> <%= (Order[0].addres).street %>, <%= (Order[0].addres).city %>, <%= (Order[0].addres).country %></p>
                            <p><strong>Phone:</strong> +91 <%= (Order[0].addres).phone %></p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-success text-white">Payment Information</div>
                        <div class="card-body">
                            <p><strong>Payment Method:</strong> <%= Order[0].paymentMethod %></p>
                            <p><strong>Total Amount:</strong> $<%= Order[0].totalPrice %></p>
                        </div>
                    </div>
                </div>
            </section>
            <p><%= //Order[0].orderItems %></p>
            <section class="card mb-4">
                <div class="card-header bg-success text-white">Ordered Items</div>
                <div class="card-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <!-- <th>Total</th> -->
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% Order[0].orderItems.forEach(element => { %>
                                <!-- <p><%= //element._id %></p> -->
                                <tr>
                                    <td><%= element.product.productName %></td>
                                    <td><%= element.quantity %></td>
                                    <td>$<%= element.price %></td>
                                    <!-- <td>$100.00</td> -->
                                    <% if (element.status === "Pending") { %>
                                        <td><span class="badge bg-warning"><%= element.status %></span></td>
                                    <% } else if (element.status === "Shipped") { %>
                                        <td><span class="badge bg-info"><%= element.status %></span></td>
                                    <% } else if (element.status === "Cancelled") { %>
                                        <td><span class="badge bg-danger"><%= element.status %></span></td>
                                    <% } else if (element.status === "Delivered") { %>
                                        <td><span class="badge bg-success"><%= element.status %></span></td>
                                    <% } else { %>
                                        <!-- Optionally render something if no case matches -->
                                    <% } %>
                                    
                                                                        
                                    
                                    <% if(element.status == "Cancelled") { %>
                                        <td><button class="btn btn-outline-danger btn-sm" disabled>Cancel</button></td>
                                    <% } else {%>
                                        <td><button class="cancel-btn btn btn-outline-danger btn-sm " data-id="<%= element._id %>">Cancel</button></td>
                                    <% } %>   

                                </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-4">
            <!-- <button class="btn btn-success">Track Order</button> -->
            <p class="mt-3">&copy; 2025 Your Company. All rights reserved.</p>
        </footer>
    </div>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
       document.querySelectorAll(".cancel-btn").forEach((button) => {
    button.addEventListener("click", async (e) => {
        const orderId = e.target.getAttribute("data-id");
        console.log("Order ID to cancel:", orderId);

        try {
            // Make the fetch request to the backend to cancel the order
            const response = await fetch(`/user/myAccount/order/cancel/${orderId}`);

            // Check if the response is successful (status code 200-299)
            if (!response.ok) {
                throw new Error(`Failed to cancel the order. Status: ${response.status}`);
            }

            // Parse the response JSON
            const details = await response.json();

            console.log("Order canceled:", details);

            // SweetAlert success message
            Swal.fire({
                title: 'Success!',
                text: 'Your order has been canceled successfully.',
                icon: 'success',
                confirmButtonText: 'OK',
            });
            window.location.reload();

            // Optionally, update the UI (e.g., remove the canceled order from the page)
        } catch (err) {
            console.error("Error canceling the order:", err);

            // SweetAlert error message
            Swal.fire({
                title: 'Error!',
                text: 'There was an error canceling the order. Please try again later.',
                icon: 'error',
                confirmButtonText: 'OK'
            });
        }
    });
});

        
    </script>
    
    
    <script>
        $(document).ready(function() {
            $('.text-success').hide().fadeIn(1500);
        });
    </script>
</body>
</html>
